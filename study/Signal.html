{% extends "global/Page.html" %}
{% load otree %}

{% block styles %}
<style>
img {
  border: 2px solid #555;
}

/* Our custom timer */
.pretty-timer {
    display: inline-block;
    background: #fff7c2;                 /* oTree-style light yellow */
    border: 2px solid #f5d768;           /* slightly darker yellow border */
    border-radius: 6px;
    padding: 6px 14px;
    font-size: 14px;
    font-weight: 600;
    color: #6a4d00;                      /* dark warm brown text */
    margin-bottom: 12px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.15);
}

/* Hide the next button so user doesn't see it */
.otree-btn-next {
    display: none !important;
}

.otree-timer {
    display: none !important;
}

</style>

{% endblock %}

{% block title %}
    New information about the {{ guess_about }}.
{% endblock %}

{% block content %}

<div id="timer" class="pretty-timer"></div>

<form id="autoform" method="post">
    {{ formfields }}
    {{ next_button }}   <!-- Hidden but needed for auto-submit -->
</form>

{% if player.round_number == 3 %}

<p style="text-align:center">
    <img src="{{ static '50balls_signal1.png' }}" width="900px"/>
</p>

{% elif player.round_number == 4 %}

<p style="text-align:center">
    <img src="{{ static '50balls_signal2.png' }}" width="900px"/>
</p>

{% elif player.round_number == 5 %}

<p style="text-align:center">
    <img src="{{ static '50balls_signal3.png' }}" width="900px"/>
</p>

{% endif %}

{% endblock %}

{% block scripts %}
<script>
(function() {

    // Values provided by vars_for_template in Python
    const start_time = {{ start_time }};
    const total_time = {{ total_time }};

    // Compute remaining seconds
    function seconds_left() {
        const now = Date.now() / 1000;
        return total_time - (now - start_time);
    }

    function tick() {
        const left = seconds_left();

        if (left <= 0) {
            // Auto click the hidden oTree next button
            document.querySelector('.otree-btn-next').click();
        } else {
            document.getElementById("timer").innerText =
                "Time remaining: " + Math.ceil(left) + " seconds";
        }
    }

    // Update 4Ã— per second
    setInterval(tick, 250);
    tick();

    // Prevent backward navigation showing a previous state
    window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
            window.location.reload();
        }
    });

})();
</script>
{% endblock %}